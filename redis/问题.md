## 使用redis时踩得坑

1. 分布式锁
    1. redis 有 `setnx` 和 `setex` 两种。正常情况下某一次请求到来时，查询某个`key` 是否有值，如果有值则判断是否是锁所对应的值。然后如果获取锁的话再`set key` 一个值，然后再过接下来的操作。在没有并发的情况下这样的思路是可以的。但是在高并发情况下，会有两个线程同时查询到该key没有设置锁状态，然后同时获取锁。因为上述一系列过程并非原子的。而`setnx` 则是直接去设置锁，如果该`key` 已经设置了值则返回失败，如果没有则返回成功。